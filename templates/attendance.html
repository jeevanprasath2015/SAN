<style>
  h2 { text-align: center; }
  form { max-width: 600px; margin: auto; }
  label { display: block; margin: 8px 0; }
  input[type="text"], input[type="date"], textarea { width: 100%; padding: 8px; box-sizing: border-box; }
  table { width: 100%; border-collapse: collapse; margin-top: 12px; }
  th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
  th { background-color: #f4f4f4; }
  button { padding: 8px 16px; background-color: #2563eb; color: white; border: none; border-radius: 4px; cursor: pointer; }
  button:hover { background-color: #1e40af; }
  a { margin-left: 8px; text-decoration: none; color: #2563eb; }
  a:hover { text-decoration: underline; }
  .muted { color: #666; font-size: 0.9em; }
</style>
{% extends "base.html" %}
{% block content %}
<h2>Attendance</h2>
<form method="get" style="margin-bottom:12px;">
  <label>Date <input type="date" name="date" value="{{ date or '' }}"></label>
  <button type="submit">Load</button>
  <a href="{{ url_for('attendance') }}">Clear</a>
</form>

<form method="post">
  <input type="hidden" name="date" value="{{ date or '' }}">
  {% if not date %}
    <p class="muted">Choose a date to take attendance</p>
  {% else %}
    <table>
      <thead><tr><th>Student</th><th>Status</th></tr></thead>
      <tbody>
        {% for s in students %}
          <tr>
            <td>{{ s }}</td>
            <td>
              <label><input type="radio" name="student_{{ s }}" value="present" {% if records.get(s) == 'present' %}checked{% endif %} {% if role != 'teacher' %}disabled{% endif %}> Present</label>
              <label><input type="radio" name="student_{{ s }}" value="absent" {% if records.get(s) != 'present' %}checked{% endif %} {% if role != 'teacher' %}disabled{% endif %}> Absent</label>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    <div style="margin-top:8px;">
      {% if role == 'teacher' %}
        <button type="submit">Save Attendance</button>
      {% else %}
        <p class="muted">Only teachers may modify attendance.</p>
      {% endif %}
    </div>
  {% endif %}
</form>

{% if all_records %}
  <h3>Saved records</h3>
  <ul>
  {% for d, rec in all_records.items() %}
    <li>{{ d }}: {{ rec|length }} students</li>
  {% endfor %}
  </ul>
{% endif %}
{% endblock %}